// ----- RSVP (shrani lokalno v brskalnik) -----
const rsvpForm = document.getElementById("rsvpForm");
const rsvpStatus = document.getElementById("rsvpStatus");

const RSVP_KEY = "najin_dan_rsvp_v1";

function loadRSVP() {
  try {
    const raw = localStorage.getItem(RSVP_KEY);
    if (!raw) return;
    const data = JSON.parse(raw);

    const attendance = document.getElementById("attendance");
    const ime = document.getElementById("ime");
    const priimek = document.getElementById("priimek");

    if (data.attendance) attendance.value = data.attendance;
    if (data.ime) ime.value = data.ime;
    if (data.priimek) priimek.value = data.priimek;

    rsvpStatus.textContent = "Podatki so že shranjeni na tej napravi ✅";
  } catch {
    // ignore
  }
}

rsvpForm.addEventListener("submit", (e) => {
  e.preventDefault();

  const attendance = document.getElementById("attendance").value;
  const ime = document.getElementById("ime").value.trim();
  const priimek = document.getElementById("priimek").value.trim();

  if (!attendance || !ime || !priimek) {
    rsvpStatus.textContent = "Prosim izpolni vsa polja.";
    return;
  }

  const data = { attendance, ime, priimek, savedAt: new Date().toISOString() };
  localStorage.setItem(RSVP_KEY, JSON.stringify(data));
  rsvpStatus.textContent = "Shranjeno ✅ (na tej napravi)";
});

loadRSVP();

// ----- Wishlist (prečrtaj + shrani lokalno) -----
const WISHLIST_KEY = "najin_dan_wishlist_v1";
const wishlistEl = document.getElementById("wishlist");

function loadWishlistState() {
  try {
    const raw = localStorage.getItem(WISHLIST_KEY);
    return raw ? JSON.parse(raw) : {};
  } catch {
    return {};
  }
}

function saveWishlistState(state) {
  localStorage.setItem(WISHLIST_KEY, JSON.stringify(state));
}

let wishlistState = loadWishlistState();

function applyWishlistUI() {
  const items = wishlistEl.querySelectorAll(".wish");
  items.forEach((li) => {
    const id = li.dataset.id;
    const checked = !!wishlistState[id];
    const checkbox = li.querySelector(".wishCheck");

    checkbox.checked = checked;
    li.classList.toggle("taken", checked);
  });
}

wishlistEl.addEventListener("change", (e) => {
  if (!e.target.classList.contains("wishCheck")) return;

  const li = e.target.closest(".wish");
  const id = li.dataset.id;

  wishlistState[id] = e.target.checked;
  saveWishlistState(wishlistState);
  applyWishlistUI();
});

applyWishlistUI();
